<div class="container-fluid mt-4">
  <div class="row g-3">
    <div class="col-12">
      <div class="card">
        <div
          class="card-header bg-success text-white d-flex justify-content-between align-items-center"
        >
          <h4 class="mb-0">Employee List</h4>
          <button class="btn btn-sm btn-light" type="button" (click)="goToForm()">
            + Add Employee
          </button>
        </div>
        <div class="card-body">
          <div class="row mb-2 align-items-end">
            <div class="col-md-4 offset-md-8 col-12">
              <label for="search">Search</label>
              <input
                type="text"
                id="search"
                class="form-control"
                placeholder="Search by Name/Department"
                (input)="onSearch($event)"
              />
            </div>
          </div>
          <div class="row">
            <div class="col-12">
              <div class="table-responsive">
                <table class="table table-bordered">
                  <thead>
                    <tr>
                      <th (click)="onSort('srno')" style="cursor: pointer; user-select: none">
                        Sr No
                        <span *ngIf="lastSortedColumn === 'srno'">{{ ascending ? '▲' : '▼' }}</span>
                      </th>
                      <th>Name</th>
                      <th>Gender</th>
                      <th>Email</th>
                      <th>Contact</th>
                      <th>Department</th>
                      <th>City</th>
                      <th>State</th>
                      <th class="text-center">Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    @for (item of paginatedEmployees(); track $index) {
                    <tr>
                      <td>{{ (currentPage - 1) * pageSize + $index + 1 }}</td>
                      <td>{{ item.name }}</td>
                      <td>{{ item.gender }}</td>
                      <td>{{ item.emailId }}</td>
                      <td>{{ item.contactNo }}</td>
                      <td>{{ item.Department }}</td>
                      <td>{{ item.city }}</td>
                      <td>{{ item.state }}</td>
                      <td class="text-center">
                        <button
                          class="btn btn-info btn-sm me-2"
                          type="button"
                          (click)="viewDetails(item)"
                        >
                          View
                        </button>
                        <button class="btn btn-primary btn-sm" type="button" (click)="onEdit(item)">
                          Edit
                        </button>
                        <button
                          class="btn btn-danger btn-sm ms-2"
                          type="button"
                          (click)="requestDelete(item.empId)"
                        >
                          Delete
                        </button>
                      </td>
                    </tr>
                    } @if ((employeeList || []).length === 0) {
                    <tr>
                      <td colspan="9" class="text-center">No records found</td>
                    </tr>
                    }
                  </tbody>
                </table>
              </div>
              <div class="d-flex align-items-center justify-content-between my-2">
                <div class="d-flex align-items-center">
                  <label class="me-2 mb-0">Show</label>
                  <select
                    class="form-select form-select-sm w-auto"
                    (change)="changePageSize($event)"
                  >
                    @for (s of pageSizes; track s) {
                    <option [value]="s" [selected]="s === pageSize">{{ s }}</option>
                    }
                  </select>
                  <label class="ms-2 mb-0">entries</label>
                </div>

                <nav aria-label="Page navigation">
                  <ul class="pagination pagination-sm mb-0">
                    <li class="page-item" [class.disabled]="currentPage === 1">
                      <button
                        class="page-link"
                        (click)="changePage(currentPage - 1)"
                        [disabled]="currentPage === 1"
                      >
                        Previous
                      </button>
                    </li>

                    @for (p of pages(); track p) {
                    <li class="page-item" [class.active]="p === currentPage">
                      <button class="page-link" (click)="changePage(p)">{{ p }}</button>
                    </li>
                    }

                    <li class="page-item" [class.disabled]="currentPage === totalPages()">
                      <button
                        class="page-link"
                        (click)="changePage(currentPage + 1)"
                        [disabled]="currentPage === totalPages()"
                      >
                        Next
                      </button>
                    </li>
                  </ul>
                </nav>
              </div>
            </div>
          </div>

          @if (showDeleteConfirm) {
          <div
            class="modal-backdrop fade show"
            style="position: fixed; inset: 0; background: rgba(0, 0, 0, 0.45); z-index: 1050"
          ></div>
          <div
            class="position-fixed top-50 start-50 translate-middle"
            style="z-index: 1060; max-width: 520px; width: 95%"
          >
            <div class="card">
              <div class="card-header">
                <strong>Confirm Delete</strong>
              </div>
              <div class="card-body">
                <p>Are you sure you want to delete this employee?</p>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="dontAsk"
                    [(ngModel)]="dontAskAgainChecked"
                  />
                  <label class="form-check-label" for="dontAsk">Don't ask again</label>
                </div>
              </div>
              <div class="card-footer text-end">
                <button
                  class="btn btn-secondary btn-sm me-2"
                  type="button"
                  (click)="cancelDelete()"
                >
                  Cancel
                </button>
                <button class="btn btn-danger btn-sm" type="button" (click)="performDelete()">
                  Delete
                </button>
              </div>
            </div>
          </div>
          }
        </div>
      </div>
    </div>
  </div>
</div>
